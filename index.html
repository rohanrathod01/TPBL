<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelpConnect - Empowering Women, Building Connections</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#DC2626', // Red-600
                        'accent-pink': '#EC4899', // Pink-500
                        'accent-teal': '#20C997', // Teal/Mint accent
                        'secondary-gray': '#4B5563', // Gray-600
                        'bg-light': '#F9FAFB', // Light background
                        'job-requested': '#F97316', // Orange-500
                        'job-accepted': '#10B981', // Emerald-500
                        'job-completed': '#0F172A', // Slate-900
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                    }
                }
            }
        }
    </script>
    <style>
        .trusted-gradient {
            background-image: linear-gradient(to right, #DC2626, #EC4899, #20C997);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Style the register form based on role selection */
        .helper-fields { display: none; }
        #auth-view.helper .helper-fields { display: block; }

        /* Custom scrollbar for better aesthetics */
        body::-webkit-scrollbar { width: 8px; }
        body::-webkit-scrollbar-track { background: #f1f1f1; }
        body::-webkit-scrollbar-thumb { background: #DC2626; border-radius: 4px; }
        body::-webkit-scrollbar-thumb:hover { background: #b30000; }
        
        .status-requested { background-color: #F97316; }
        .status-accepted { background-color: #10B981; }
        .status-completed { background-color: #0F172A; }
        .status-rejected, .status-cancelled { background-color: #EF4444; }
    </style>
</head>
<body class="bg-bg-light font-sans text-gray-800">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white shadow-soft">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center cursor-pointer" onclick="navigate('home')">
                    <svg class="h-6 w-6 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm-1-13h2v6h-2zM11 15h2v2h-2z"/></svg>
                    <span class="ml-2 text-xl font-bold text-gray-900">HelpConnect</span>
                </div>
                <!-- Navigation Links -->
                <div class="hidden sm:ml-6 sm:flex sm:space-x-8" id="nav-links">
                    <!-- Links populated by JS -->
                </div>
                <!-- Auth Buttons -->
                <div class="flex items-center space-x-4">
                    <button id="auth-button" class="bg-primary text-white hover:bg-red-700 transition-colors py-2 px-4 rounded-full text-sm font-medium shadow-md" onclick="handleAuthClick()">
                        Sign In / Register
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 min-h-[80vh]">
        
        <!-- View Container (SPA Routing Simulation) -->
        <div id="view-container">

            <!-- ---------------------------------------------------- -->
            <!-- 1. HOME VIEW (Initial Content) -->
            <!-- ---------------------------------------------------- -->
            <section id="home-view">
                
                <!-- Hero Section (UNCHANGED) -->
                <div class="text-center py-20 bg-white rounded-xl shadow-xl">
                    <p class="text-sm font-semibold tracking-widest text-accent-pink mb-4 flex items-center justify-center">
                        <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        Empowering Women, Building Connections
                    </p>
                    <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 leading-tight mb-6">
                        Connect with <span class="trusted-gradient">Trusted Help</span> for Your Home
                    </h1>
                    <p class="text-lg text-secondary-gray max-w-3xl mx-auto mb-10">
                        A platform connecting working women with reliable house-help, while creating dignified livelihood opportunities for women seeking financial independence.
                    </p>
                    <div class="flex justify-center space-x-6">
                        <button class="bg-primary text-white hover:bg-red-700 transition-all py-3 px-8 rounded-full text-lg font-semibold shadow-lg shadow-red-300 transform hover:scale-105" onclick="navigate('search')">
                            Find Helpers &rarr;
                        </button>
                        <button class="border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 transition-all py-3 px-8 rounded-full text-lg font-semibold shadow-lg" onclick="navigate('auth', 'register')">
                            Become a Helper
                        </button>
                    </div>
                </div>

                <!-- Why Choose Us Section (UNCHANGED) -->
                <div class="pt-20 pb-16">
                    <h2 class="text-3xl font-bold text-center text-gray-900 mb-4">Why Choose HelpConnect</h2>
                    <p class="text-center text-secondary-gray mb-12">A platform built with care, security, and empowerment at its core.</p>

                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-xl shadow-soft border-t-4 border-accent-pink hover:shadow-lg transition-shadow">
                            <div class="text-4xl text-accent-pink mb-4">
                                <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c-1.29.079-2.522.368-3.692.857M5.072 5.072a11.955 11.955 0 00-1.077 3.321m-.008 3.529a11.955 11.955 0 001.077 3.321M12 20.056a11.955 11.955 0 01-8.525-3.525m17.05 0a11.955 11.955 0 01-8.525 3.525M17.05 6.95c.57.57 1.05 1.205 1.45 1.905m-3.418-3.921a11.955 11.955 0 00-3.692-.857"/></svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Verified Profiles</h3>
                            <p class="text-secondary-gray text-sm">All helpers undergo thorough verification for your peace of mind and safety.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-soft border-t-4 border-accent-teal hover:shadow-lg transition-shadow">
                            <div class="text-4xl text-accent-teal mb-4">
                                <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 9h.01M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Flexible Scheduling</h3>
                            <p class="text-secondary-gray text-sm">Book helpers based on your availability and requirements with easy time slot selection.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-soft border-t-4 border-primary hover:shadow-lg transition-shadow">
                            <div class="text-4xl text-primary mb-4">
                                <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.243.588 1.813l-2.8 2.036a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.036a1 1 0 00-1.175 0l-2.8 2.036c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118l-2.8-2.036c-.785-.57-.381-1.813.588-1.813h3.462a1 1 0 00.95-.69l1.07-3.292z"/></svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Ratings & Reviews</h3>
                            <p class="text-secondary-gray text-sm">Make informed decisions with transparent feedback from other clients.</p>
                        </div>
                    </div>
                </div>

                <!-- How It Works Section (UNCHANGED) -->
                <div class="pt-16 pb-20">
                    <h2 class="text-3xl font-bold text-center text-gray-900 mb-12">How It Works</h2>
                    
                    <div class="flex flex-wrap justify-center items-stretch space-y-8 md:space-y-0 md:space-x-10">
                        <div class="w-full md:w-1/4 text-center">
                            <div class="relative inline-block mb-4">
                                <div class="w-12 h-12 rounded-full bg-accent-pink text-white flex items-center justify-center font-bold text-xl ring-8 ring-accent-pink/20">01</div>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">Search & Browse</h3>
                            <p class="text-sm text-secondary-gray">Browse through verified helper profiles with detailed skills and ratings.</p>
                        </div>
                        
                        <div class="hidden md:block w-0 h-0 border-t-8 border-r-8 border-b-8 border-transparent border-t-gray-300 transform translate-y-12 rotate-90 md:rotate-0"></div>

                        <div class="w-full md:w-1/4 text-center">
                            <div class="relative inline-block mb-4">
                                <div class="w-12 h-12 rounded-full bg-accent-teal text-white flex items-center justify-center font-bold text-xl ring-8 ring-accent-teal/20">02</div>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">Select a Helper</h3>
                            <p class="text-sm text-secondary-gray">Choose the perfect match based on skills, availability, and reviews.</p>
                        </div>
                        
                         <div class="hidden md:block w-0 h-0 border-t-8 border-r-8 border-b-8 border-transparent border-t-gray-300 transform translate-y-12 rotate-90 md:rotate-0"></div>

                        <div class="w-full md:w-1/4 text-center">
                            <div class="relative inline-block mb-4">
                                <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center font-bold text-xl ring-8 ring-primary/20">03</div>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">Schedule & Confirm</h3>
                            <p class="text-sm text-secondary-gray">Book your preferred time slots and confirm the job details.</p>
                        </div>
                        
                         <div class="hidden md:block w-0 h-0 border-t-8 border-r-8 border-b-8 border-transparent border-t-gray-300 transform translate-y-12 rotate-90 md:rotate-0"></div>

                        <div class="w-full md:w-1/4 text-center">
                            <div class="relative inline-block mb-4">
                                <div class="w-12 h-12 rounded-full bg-gray-500 text-white flex items-center justify-center font-bold text-xl ring-8 ring-gray-500/20">04</div>
                            </div>
                            <h3 class="text-lg font-semibold mb-2">Review & Rate</h3>
                            <p class="text-sm text-secondary-gray">Share your experience to help the community grow stronger and trustier.</p>
                        </div>
                    </div>
                </div>

            </section>
            
            <!-- ---------------------------------------------------- -->
            <!-- 2. LOGIN / REGISTER VIEW (UNCHANGED) -->
            <!-- ---------------------------------------------------- -->
            <section id="auth-view" class="hidden max-w-lg mx-auto bg-white p-8 rounded-xl shadow-xl">
                <h1 id="auth-title" class="text-3xl font-bold text-gray-900 mb-6 text-center"></h1>
                
                <form id="auth-form" onsubmit="handleAuthSubmit(event)">
                    <div id="auth-tabs" class="flex mb-6 border-b border-gray-200">
                        <button type="button" class="py-2 px-4 text-secondary-gray font-medium transition-colors border-b-2 border-transparent hover:border-primary tab-login" onclick="switchAuthMode('login')">Login</button>
                        <button type="button" class="py-2 px-4 text-secondary-gray font-medium transition-colors border-b-2 border-transparent hover:border-primary tab-register" onclick="switchAuthMode('register')">Register</button>
                    </div>

                    <div id="role-select" class="mb-6 hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">I am registering as a:</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center space-x-2 p-3 bg-bg-light rounded-lg border border-gray-300 cursor-pointer w-1/2">
                                <input type="radio" name="role" value="client" checked onchange="updateRegisterForm('client')" class="text-primary focus:ring-primary">
                                <span class="text-sm font-medium">Client (Employer)</span>
                            </label>
                            <label class="flex items-center space-x-2 p-3 bg-bg-light rounded-lg border border-gray-300 cursor-pointer w-1/2">
                                <input type="radio" name="role" value="helper" onchange="updateRegisterForm('helper')" class="text-primary focus:ring-primary">
                                <span class="text-sm font-medium">Helper</span>
                            </label>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <input type="text" id="auth-full-name" placeholder="Full Name (Register only)" class="auth-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" style="display: none;">
                        <input type="email" id="auth-email" placeholder="Email Address" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        <input type="password" id="auth-password" placeholder="Password (min 6 characters)" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                    </div>

                    <div id="helper-fields" class="helper-fields space-y-4 mt-4">
                        <input type="text" id="auth-city" placeholder="City (e.g., Mumbai)" class="auth-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        <input type="text" id="auth-skills" placeholder="Skills (e.g., Cooking, Cleaning)" class="auth-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        <input type="number" id="auth-hourly-rate" placeholder="Hourly Rate (₹)" min="50" class="auth-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                    </div>

                    <button type="submit" id="auth-submit-btn" class="w-full mt-6 bg-primary text-white hover:bg-red-700 transition-colors py-3 px-4 rounded-lg font-semibold shadow-md"></button>
                </form>

                <p id="auth-message" class="mt-4 text-center text-sm font-medium text-red-500"></p>
            </section>


            <!-- ---------------------------------------------------- -->
            <!-- 3. SEARCH VIEW (UNCHANGED) -->
            <!-- ---------------------------------------------------- -->
            <section id="search-view" class="hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Find Your Perfect Helper</h1>
                
                <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-4 mb-10 p-4 bg-white rounded-xl shadow-soft">
                    <div class="flex-grow flex items-center border border-gray-200 rounded-lg p-2">
                        <svg class="h-5 w-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                        <input type="text" id="search-query" placeholder="Search by City, Skill (e.g., Mumbai, Cooking)..." class="w-full focus:outline-none text-gray-700 placeholder-gray-400" onkeyup="handleSearch(event)">
                    </div>
                    <button class="flex items-center justify-center bg-primary text-white hover:bg-red-700 transition-colors py-3 px-6 rounded-lg font-semibold shadow-md" onclick="handleSearch(null)">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
                        Search
                    </button>
                </div>

                <p id="helper-count" class="text-secondary-gray mb-6"></p>
                
                <div id="helper-results" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                </div>
                
            </section>

            <!-- ---------------------------------------------------- -->
            <!-- 4. PROFILE VIEW (UNCHANGED) -->
            <!-- ---------------------------------------------------- -->
            <section id="profile-view" class="hidden">
            </section>
            
            <!-- ---------------------------------------------------- -->
            <!-- 5. HELPER DASHBOARD VIEW (NEW) -->
            <!-- ---------------------------------------------------- -->
            <section id="helper-dashboard-view" class="hidden">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Hello, <span id="helper-name"></span>! Your Job Requests</h1>
                <div class="space-y-6" id="jobs-list-container">
                    <!-- Jobs will be injected here -->
                </div>
                <p id="no-jobs-message" class="hidden text-secondary-gray mt-8 text-center py-10">You have no pending job requests or job history.</p>
            </section>


        </div>
    </main>

    <!-- Footer (UNCHANGED) -->
    <footer class="bg-white border-t border-gray-100 mt-16 pt-10 pb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8">
                <div class="col-span-2 lg:col-span-1">
                    <div class="flex items-center mb-4">
                        <svg class="h-6 w-6 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm-1-13h2v6h-2zM11 15h2v2h-2z"/></svg>
                        <span class="ml-2 text-xl font-bold text-gray-900">HelpConnect</span>
                    </div>
                    <p class="text-sm text-secondary-gray">Empowering women through dignified work opportunities and reliable connections.</p>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-900 mb-4">For Clients</h4>
                    <ul class="space-y-2 text-sm text-secondary-gray">
                        <li><a href="#" class="hover:text-primary transition-colors" onclick="navigate('search')">Find Helpers</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Post a Job</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">How It Works</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-900 mb-4">For Helpers</h4>
                    <ul class="space-y-2 text-sm text-secondary-gray">
                        <li><a href="#" class="hover:text-primary transition-colors" onclick="navigate('auth', 'register')">Become a Helper</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors" onclick="alertMessage('Helper Dashboard requires login.')">Helper Dashboard</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Resources</a></li>
                    </ul>
                </div>

                <div class="col-span-2 md:col-span-1">
                    <h4 class="text-sm font-semibold text-gray-900 mb-4">Contact Us</h4>
                    <ul class="space-y-3 text-sm text-secondary-gray">
                        <li class="flex items-center">
                            <svg class="h-5 w-5 mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                            <a href="mailto:support@helpconnect.com" class="hover:text-primary transition-colors">support@helpconnect.com</a>
                        </li>
                        <li class="flex items-center">
                            <svg class="h-5 w-5 mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                            <span>+91 123 456 7890</span>
                        </li>
                        <li class="flex items-center">
                            <svg class="h-5 w-5 mr-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            <span>Mumbai, Maharashtra</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="mt-8 border-t border-gray-100 pt-6 text-center">
                <p class="text-sm text-secondary-gray">&copy; 2025 HelpConnect. All rights reserved. Built with care for empowering women.</p>
            </div>
        </div>
    </footer>

    <!-- Simple Message Box (UNCHANGED) -->
    <div id="message-box" class="fixed bottom-5 right-5 z-50 p-4 bg-primary text-white rounded-lg shadow-xl hidden transition-opacity duration-300"></div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:5000/api'; 
        
        // --- Global State Simulation ---
        let currentUserId = null;
        let currentUserRole = null;
        let currentUserName = null;
        let currentHelperId = null;

        const views = {
            home: document.getElementById('home-view'),
            auth: document.getElementById('auth-view'),
            search: document.getElementById('search-view'),
            profile: document.getElementById('profile-view'),
            helper_dashboard: document.getElementById('helper-dashboard-view'),
        };
        
        let authMode = 'login'; // 'login' or 'register'

        // --- UI / Navigation Logic ---

        function navigate(viewName, id = null) {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            
            if (views[viewName]) {
                views[viewName].classList.remove('hidden');
            }

            if (viewName === 'search') {
                renderSearchResults();
            } else if (viewName === 'profile' && id) {
                currentHelperId = id;
                renderProfileDetails(id);
            } else if (viewName === 'auth') {
                switchAuthMode(id || 'login');
            } else if (viewName === 'helper_dashboard' && currentUserId && currentUserRole === 'helper') {
                 renderHelperDashboard();
            }
            
            updateNavbar();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function alertMessage(message, isError = false) {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.classList.remove('hidden', 'opacity-0', 'bg-red-500', 'bg-primary');
            box.classList.add(isError ? 'bg-red-500' : 'bg-primary', 'opacity-100');
            setTimeout(() => {
                box.classList.remove('opacity-100');
                box.classList.add('opacity-0');
                setTimeout(() => box.classList.add('hidden'), 300);
            }, 3000);
        }

        function updateNavbar() {
            const authButton = document.getElementById('auth-button');
            const navLinks = document.getElementById('nav-links');

            navLinks.innerHTML = '';
            
            if (currentUserId) {
                authButton.textContent = `Sign Out (${currentUserName.split(' ')[0]})`;
                authButton.onclick = handleSignOut;
                authButton.classList.remove('text-secondary-gray');
                authButton.classList.add('bg-primary', 'text-white');

                // Add links based on role
                if (currentUserRole === 'helper') {
                    navLinks.insertAdjacentHTML('beforeend', `<span class="text-secondary-gray hover:text-primary transition-colors py-2 px-3 rounded-md text-sm font-medium cursor-pointer" onclick="navigate('helper_dashboard')">Dashboard</span>`);
                } else if (currentUserRole === 'client') {
                    navLinks.insertAdjacentHTML('beforeend', `<span class="text-secondary-gray hover:text-primary transition-colors py-2 px-3 rounded-md text-sm font-medium cursor-pointer" onclick="alertMessage('Client Dashboard view not implemented yet.')">Dashboard</span>`);
                }
                navLinks.insertAdjacentHTML('beforeend', `<a href="#" class="text-secondary-gray hover:text-primary transition-colors py-2 px-3 rounded-md text-sm font-medium" onclick="navigate('search')">Find Help</a>`);
                
            } else {
                authButton.textContent = 'Sign In / Register';
                authButton.onclick = handleAuthClick;
                authButton.classList.remove('bg-primary', 'text-white');
                authButton.classList.add('text-secondary-gray', 'border', 'border-gray-300', 'bg-white', 'hover:bg-gray-100');
                
                navLinks.insertAdjacentHTML('beforeend', `<a href="#" class="text-secondary-gray hover:text-primary transition-colors py-2 px-3 rounded-md text-sm font-medium" onclick="navigate('search')">Find Help</a>`);
                navLinks.insertAdjacentHTML('beforeend', `<a href="#" class="text-secondary-gray hover:text-primary transition-colors py-2 px-3 rounded-md text-sm font-medium" onclick="navigate('auth', 'register')">Post a Job</a>`);
                navLinks.insertAdjacentHTML('beforeend', `<a href="#" class="text-secondary-gray hover:text-primary transition-colors py-2 px-3 rounded-md text-sm font-medium" onclick="navigate('auth', 'register')">Become a Helper</a>`);
            }
        }

        function handleAuthClick() {
            if (currentUserId) {
                handleSignOut();
            } else {
                navigate('auth', 'login');
            }
        }

        function handleSignOut() {
            currentUserId = null;
            currentUserRole = null;
            currentUserName = null;
            alertMessage('Successfully signed out.');
            navigate('home');
        }

        // --- Auth View Logic (UNCHANGED) ---

        function switchAuthMode(mode) {
            authMode = mode;
            const title = document.getElementById('auth-title');
            const submitBtn = document.getElementById('auth-submit-btn');
            const roleSelect = document.getElementById('role-select');
            const fullName = document.getElementById('auth-full-name');
            const authView = document.getElementById('auth-view');
            
            document.getElementById('auth-form').reset();
            document.getElementById('auth-message').textContent = '';

            if (mode === 'login') {
                title.textContent = 'Welcome Back! Login';
                submitBtn.textContent = 'Login';
                roleSelect.classList.add('hidden');
                fullName.style.display = 'none';
                
                document.getElementById('helper-fields').classList.remove('helper-fields');
                authView.classList.remove('helper');
            } else { 
                title.textContent = 'Create a New Account';
                submitBtn.textContent = 'Register';
                roleSelect.classList.remove('hidden');
                fullName.style.display = 'block';

                const selectedRole = document.querySelector('input[name="role"]:checked').value;
                updateRegisterForm(selectedRole);
            }

            document.querySelectorAll('#auth-tabs button').forEach(btn => {
                btn.classList.remove('border-primary');
            });
            document.querySelector(`.tab-${mode}`).classList.add('border-primary');
        }

        function updateRegisterForm(role) {
            const authView = document.getElementById('auth-view');
            if (role === 'helper') {
                authView.classList.add('helper');
                document.getElementById('helper-fields').classList.add('helper-fields');
            } else {
                authView.classList.remove('helper');
                document.getElementById('helper-fields').classList.remove('helper-fields');
            }
        }

        async function handleAuthSubmit(event) {
            event.preventDefault();
            const messageBox = document.getElementById('auth-message');
            messageBox.textContent = '';
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            const payload = { email, password };
            let endpoint = authMode === 'login' ? '/login' : '/register';

            if (authMode === 'register') {
                const role = document.querySelector('input[name="role"]:checked').value;
                const fullName = document.getElementById('auth-full-name').value;
                const city = document.getElementById('auth-city').value;
                
                if (!fullName || !city) {
                    messageBox.textContent = 'Please fill out all required fields.';
                    return;
                }
                
                payload.full_name = fullName;
                payload.city = city;
                payload.role = role;
                
                if (role === 'helper') {
                    payload.skills = document.getElementById('auth-skills').value || 'General';
                    payload.hourly_rate = parseFloat(document.getElementById('auth-hourly-rate').value) || 200.00;
                }
            }

            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (response.ok) {
                    currentUserId = result.user_id;
                    currentUserRole = result.role;
                    currentUserName = result.full_name;
                    
                    alertMessage(`Welcome back, ${currentUserName.split(' ')[0]}! You are logged in as a ${currentUserRole}.`);
                    
                    // Direct users to their appropriate landing page after login
                    if (currentUserRole === 'helper') {
                        navigate('helper_dashboard');
                    } else {
                        navigate('search'); 
                    }
                } else {
                    messageBox.textContent = result.error || "An unknown error occurred.";
                }
            } catch (error) {
                messageBox.textContent = "Network error. Is the Python server running?";
            }
        }


        // --- Data Fetching and Rendering Logic (UNCHANGED) ---

        async function fetchData(endpoint, method = 'GET', body = null, retries = 3) {
            const url = `${API_BASE_URL}${endpoint}`;
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (body) {
                options.body = JSON.stringify(body);
            }

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ error: 'Unknown server error' }));
                        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    if (i === retries - 1) {
                        alertMessage(`Error: ${error.message}. Is the Python server running?`, true);
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(res => setTimeout(res, delay));
                }
            }
        }
        
        async function renderSearchResults(query = '') {
            const resultsContainer = document.getElementById('helper-results');
            const countElement = document.getElementById('helper-count');
            resultsContainer.innerHTML = '<div class="md:col-span-3 text-center py-10 text-primary animate-pulse">Loading helpers...</div>';
            countElement.textContent = '';
            
            try {
                const urlParams = new URLSearchParams();
                
                if (query) {
                    const parts = query.split(',').map(p => p.trim()).filter(p => p);
                    if (parts.length > 0) urlParams.set('city', parts[0]);
                    if (parts.length > 1) urlParams.set('skill', parts[1]);
                    else if (parts.length === 1 && parts[0].length > 0) urlParams.set('skill', parts[0]); 
                }

                const helpers = await fetchData(`/helpers?${urlParams.toString()}`);
                
                resultsContainer.innerHTML = '';
                
                if (helpers.length === 0) {
                    resultsContainer.innerHTML = `<div class="md:col-span-3 text-center py-10 text-secondary-gray">No helpers found matching your criteria.</div>`;
                    countElement.textContent = `0 helpers available`;
                    return;
                }

                countElement.textContent = `${helpers.length} helpers available`;

                helpers.forEach(helper => {
                    const skillsHtml = helper.skills ? helper.skills.split(',').map(skill => 
                        `<span class="text-xs bg-bg-light text-secondary-gray px-3 py-1 rounded-full border border-gray-200">${skill.trim()}</span>`
                    ).join('') : '';

                    const card = `
                        <div class="bg-white p-6 rounded-xl shadow-xl hover:shadow-2xl transition-shadow duration-300 transform hover:-translate-y-1 flex flex-col">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white font-bold text-xl mr-4 shadow-md flex-shrink-0">
                                    ${helper.full_name.split(' ').map(n => n[0]).join('')}
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">${helper.full_name}</h3>
                                    <p class="text-sm text-secondary-gray flex items-center">
                                        <svg class="h-4 w-4 mr-1 text-primary" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>
                                        ${helper.city}, ${helper.state || 'N/A'}
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex items-center mb-4">
                                <div class="text-lg font-semibold text-primary mr-1">${helper.rating.toFixed(1)}</div>
                                <svg class="h-5 w-5 text-yellow-400 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.243.588 1.813l-2.8 2.036a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.036a1 1 0 00-1.175 0l-2.8 2.036c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118l-2.8-2.036c-.785-.57-.381-1.813.588-1.813h3.462a1 1 0 00.95-.69l1.07-3.292z"/></svg>
                                <span class="text-sm text-secondary-gray ml-2">(${helper.reviews_count} reviews)</span>
                            </div>

                            <div class="flex flex-wrap gap-2 mb-4">
                                ${skillsHtml}
                            </div>

                            <div class="mt-auto pt-4 border-t border-gray-100 flex justify-between items-center">
                                <div>
                                    <span class="text-xl font-bold text-primary">₹${helper.hourly_rate}</span>
                                    <span class="text-sm text-secondary-gray">/hour</span>
                                </div>
                                <button class="bg-accent-pink text-white hover:bg-pink-600 transition-colors py-2 px-6 rounded-lg font-semibold shadow-md" onclick="navigate('profile', '${helper.id}')">
                                    View Profile
                                </button>
                            </div>
                        </div>
                    `;
                    resultsContainer.insertAdjacentHTML('beforeend', card);
                });
            } catch (error) {
                resultsContainer.innerHTML = `<div class="md:col-span-3 text-center py-10 text-red-500">Could not load helper data. Check if Python server is running.</div>`;
            }
        }
        
        async function renderProfileDetails(id) {
            const profileContainer = document.getElementById('profile-view');
            profileContainer.innerHTML = '<div class="text-center py-10 text-primary animate-pulse">Loading profile...</div>';
            
            try {
                const helper = await fetchData(`/helpers/${id}`);
                
                const formatAvailability = (availabilities) => {
                    const daysMap = { 'Mon': 'Monday', 'Tue': 'Tuesday', 'Wed': 'Wednesday', 'Thu': 'Thursday', 'Fri': 'Friday', 'Sat': 'Saturday', 'Sun': 'Sunday' };
                    const formatted = {};
                    availabilities.forEach(a => {
                        a.days.split(',').forEach(dayKey => {
                            const fullDay = daysMap[dayKey.trim()] || dayKey.trim();
                            formatted[fullDay] = `${a.start_time} - ${a.end_time}`;
                        });
                    });
                    
                    const sortedDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                    return sortedDays.map(day => {
                        const time = formatted[day] || 'Unavailable';
                        return `
                            <div class="flex justify-between py-2 border-b border-gray-100 last:border-b-0">
                                <span class="font-medium">${day}</span>
                                <span class="${time === 'Unavailable' ? 'text-secondary-gray/50' : 'text-primary font-semibold'}">${time}</span>
                            </div>
                        `;
                    }).join('');
                };

                const renderSkills = (skills) => {
                    if (!skills) return '<p class="text-secondary-gray/60">No skills listed.</p>';
                    return skills.split(',').map(skill => 
                        `<span class="text-sm font-semibold bg-bg-light text-primary px-4 py-1.5 rounded-full border-2 border-primary/20 hover:bg-primary/10 transition-colors">${skill.trim()}</span>`
                    ).join('');
                };

                const renderReviews = (reviews) => {
                    if (reviews.length === 0) return '<p class="text-secondary-gray">No reviews yet.</p>';
                    
                    return reviews.map(review => {
                        const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                        const initials = review.reviewer_name.split(' ').map(n => n[0]).join('');

                        return `
                            <div class="border-b border-gray-100 pb-4 mb-4">
                                <div class="flex items-center mb-2">
                                    <div class="w-8 h-8 rounded-full bg-accent-teal flex items-center justify-center text-white font-bold text-sm mr-3">${initials}</div>
                                    <div>
                                        <p class="font-semibold text-gray-900">${review.reviewer_name}</p>
                                        <p class="text-xs text-secondary-gray">${new Date(review.created_at).toLocaleDateString()}</p>
                                    </div>
                                </div>
                                <p class="text-lg text-yellow-500">${stars}</p>
                                <p class="text-sm text-secondary-gray mt-1">${review.comment}</p>
                            </div>
                        `;
                    }).join('');
                };

                const bookButton = currentUserId && currentUserRole === 'client' ? 
                    `<button class="flex items-center justify-center bg-primary text-white hover:bg-red-700 transition-colors py-3 px-6 rounded-lg font-semibold shadow-md" onclick="handleBookNow()">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 9h.01M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        Book Now
                    </button>` : 
                    `<button class="flex items-center justify-center bg-gray-400 text-white py-3 px-6 rounded-lg font-semibold cursor-not-allowed" onclick="alertMessage('Please login as a Client to book a service.', true)">
                        Book Now (Client Login Required)
                    </button>`;


                const profileHtml = `
                    <div class="relative bg-white rounded-xl shadow-xl overflow-hidden mb-10">
                        <div class="h-40 bg-gradient-to-r from-primary to-accent-pink"></div>
                        
                        <div class="p-6 md:p-10 -mt-16">
                            <div class="flex flex-col md:flex-row justify-between items-start">
                                <div class="flex items-center mb-6 md:mb-0">
                                    <div class="w-20 h-20 md:w-28 md:h-28 rounded-full bg-primary/80 border-4 border-white flex items-center justify-center text-white font-extrabold text-3xl mr-6 shadow-lg flex-shrink-0">
                                        ${helper.full_name.split(' ').map(n => n[0]).join('')}
                                    </div>
                                    <div>
                                        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">${helper.full_name}</h1>
                                        <p class="text-secondary-gray flex items-center mt-1">
                                            <svg class="h-4 w-4 mr-1 text-primary" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>
                                            ${helper.city}, ${helper.state || 'N/A'} &bull; 
                                            <span class="ml-2 text-yellow-500 text-lg font-bold">${helper.rating.toFixed(1)}</span> (${helper.reviews_count} reviews)
                                        </p>
                                        <p class="text-3xl font-extrabold text-primary mt-3">
                                            ₹${helper.hourly_rate.toFixed(2)}<span class="text-base font-medium text-secondary-gray">/hour</span>
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="flex flex-col space-y-3 w-full md:w-auto">
                                    ${bookButton}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        
                        <div class="lg:col-span-2 space-y-8">
                            
                            <div class="bg-white p-6 rounded-xl shadow-soft">
                                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">About</h2>
                                <p class="text-secondary-gray leading-relaxed">${helper.description}</p>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-soft">
                                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">Skills & Services</h2>
                                <div class="flex flex-wrap gap-3">
                                    ${renderSkills(helper.skills)}
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-xl shadow-soft">
                                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">Reviews & Ratings</h2>
                                <div id="reviews-list" class="space-y-6">
                                    ${renderReviews(helper.reviews)}
                                </div>
                            </div>

                        </div>

                        <div class="lg:col-span-1 space-y-8">

                            <div class="bg-white p-6 rounded-xl shadow-soft">
                                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">Availability</h2>
                                <div class="text-sm text-secondary-gray">
                                    ${formatAvailability(helper.availabilities)}
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-xl shadow-soft">
                                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">Quick Stats</h2>
                                <div class="space-y-3 text-sm">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-secondary-gray">Response Time:</span>
                                        <span class="font-semibold text-gray-900">Within 1 hour</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-secondary-gray">Jobs Completed:</span>
                                        <span class="font-semibold text-gray-900">${helper.reviews_count}+</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-secondary-gray">Member Since:</span>
                                        <span class="font-semibold text-gray-900">${helper.member_since}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                `;
                profileContainer.innerHTML = profileHtml;

            } catch (error) {
                profileContainer.innerHTML = `<div class="text-center py-10 text-red-500">Failed to load helper profile.</div>`;
            }
        }

        async function handleBookNow() {
            if (!currentUserId || currentUserRole !== 'client') {
                 alertMessage('Please login as a Client to book a service.', true);
                 return;
            }
            if (!currentHelperId) return alertMessage("Error: No helper selected.");

            const mockJobData = {
                client_id: currentUserId,
                helper_id: currentHelperId,
                // These should come from a form, but we'll mock them for now
                scheduled_date: '2025-11-10', 
                scheduled_start: '09:00',
                scheduled_end: '13:00',
                details: 'I need a 4-hour house cleaning session.',
                agreed_hourly_rate: 200.00,
                total_amount: 800.00
            };

            alertMessage('Attempting to submit job request...');

            try {
                await fetchData(`/jobs`, 'POST', mockJobData);
                alertMessage('✅ Job request submitted! Helper will confirm shortly.', false);
                navigate('search'); 
            } catch (error) {
                // Error handled in fetchData
            }
        }
        
        function handleSearch(event) {
            if (event && event.type === 'keyup' && event.key !== 'Enter') return;
            
            const query = document.getElementById('search-query').value.trim();
            renderSearchResults(query);
        }

        // --- NEW Helper Dashboard Logic ---

        async function renderHelperDashboard() {
            const jobsContainer = document.getElementById('jobs-list-container');
            const helperName = document.getElementById('helper-name');
            const noJobsMessage = document.getElementById('no-jobs-message');

            helperName.textContent = currentUserName.split(' ')[0];
            jobsContainer.innerHTML = '<div class="text-center py-10 text-primary animate-pulse">Loading job requests...</div>';
            noJobsMessage.classList.add('hidden');

            try {
                const jobs = await fetchData(`/jobs/helper/${currentUserId}`);
                jobsContainer.innerHTML = ''; 

                if (jobs.length === 0) {
                    noJobsMessage.classList.remove('hidden');
                    return;
                }
                
                jobs.forEach(job => {
                    const statusClass = `status-${job.status.toLowerCase().replace(' ', '-')}`;
                    
                    const actionButtons = (job.status === 'requested') ? 
                        `<div class="flex space-x-3">
                            <button class="bg-green-600 text-white hover:bg-green-700 py-2 px-4 rounded-lg font-semibold transition-colors text-sm" 
                                onclick="updateJobStatus('${job.id}', 'accepted')">
                                Accept Job
                            </button>
                            <button class="border border-red-600 text-red-600 hover:bg-red-50 py-2 px-4 rounded-lg font-semibold transition-colors text-sm" 
                                onclick="updateJobStatus('${job.id}', 'rejected')">
                                Reject
                            </button>
                        </div>` :
                        (job.status === 'accepted') ?
                        `<div class="flex space-x-3">
                            <button class="bg-blue-600 text-white hover:bg-blue-700 py-2 px-4 rounded-lg font-semibold transition-colors text-sm" 
                                onclick="updateJobStatus('${job.id}', 'completed')">
                                Mark as Completed
                            </button>
                            <span class="text-green-600 font-bold text-sm flex items-center">
                                Accepted &bull; Start Date: ${job.scheduled_date}
                            </span>
                        </div>` :
                        `<span class="text-secondary-gray text-sm">No further actions available.</span>`;


                    const jobCard = `
                        <div class="bg-white p-6 rounded-xl shadow-soft border-l-8 ${statusClass} flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div class="flex-grow">
                                <div class="flex items-center space-x-3 mb-2">
                                    <span class="px-3 py-1 text-xs font-bold text-white uppercase rounded-full ${statusClass}">${job.status}</span>
                                    <p class="text-lg font-bold text-gray-900">Job from ${job.client_name} in ${job.city}</p>
                                </div>
                                <p class="text-sm text-secondary-gray mb-3">${job.details}</p>
                                <div class="text-xs space-y-1">
                                    <p class="font-medium">Date: <span class="text-primary">${job.scheduled_date}</span></p>
                                    <p class="font-medium">Time: ${job.scheduled_start} - ${job.scheduled_end}</p>
                                    <p class="font-medium">Client Phone: ${job.phone}</p>
                                </div>
                            </div>
                            <div class="mt-4 md:mt-0 md:ml-6 flex-shrink-0">
                                ${actionButtons}
                            </div>
                        </div>
                    `;
                    jobsContainer.insertAdjacentHTML('beforeend', jobCard);
                });

            } catch (error) {
                jobsContainer.innerHTML = `<div class="text-center py-10 text-red-500">Failed to load jobs. Please check the server logs.</div>`;
            }
        }

        async function updateJobStatus(jobId, newStatus) {
            alertMessage(`Updating job status to ${newStatus}...`);
            
            try {
                await fetchData(`/jobs/${jobId}/status`, 'PUT', { status: newStatus });
                alertMessage(`Job status updated to ${newStatus}.`, false);
                
                // If successful, re-render the dashboard to show the change
                renderHelperDashboard(); 

                // For a real application, you would also notify the client here!
            } catch (error) {
                // Error handled in fetchData
            }
        }

        // --- Initial Load ---
        window.onload = () => {
            updateNavbar();
            navigate('home');
            switchAuthMode('login');
        };

    </script>
</body>
</html>
